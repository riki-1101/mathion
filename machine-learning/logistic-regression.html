<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>ロジスティック回帰</title>
        <link rel="stylesheet" href="../css/style.css">
        <script src="../js/mathjax.js"></script>
    </head>
    <body>
        <header id="header"></header>
        <aside id="sidebar"></aside>
        <main id="contents">
            <h1>ロジスティック回帰</h1>
            <div id="table-of-contents"></div>
            <section id="1">
                <h2>ロジスティック回帰の概要</h2>
                <p class="indent">
                    <strong>ロジスティック回帰</strong>とは、「\(0\) か \(1\) か」や「Yes か No か」のような<strong>二値分類</strong>を行うための統計モデルです。
                    名前に「回帰」とありますが、実際は分類問題でよく使われます。
                </p>
                <p class="indent">
                    例えば、次のような判定ができます。
                </p>
                <ul>
                    <li>メールがスパムかスパムでないか</li>
                    <li>試験に合格するか合格しないか</li>
                    <li>ある商品を買うか買わないか</li>
                </ul>
                <figure class="th">
                    <figcaption>アルゴリズム（ロジスティック回帰）</figcaption>
                    <p class="indent">
                        次のような2値分類のデータセットを考える。
                    </p>
                    <div class="math">
                        \[
                        \{(\boldsymbol{x}_i,y_i) \mid \boldsymbol{x}_i\in\mathbb{R}^d,~y_i\in\{0,1\}\}_{i=1}^N
                        \]
                    </div>
                    <ol>
                        <li>
                            ハイパーパラメータである、エポック数 \(E\) と学習率 \(\eta\) を設定する。
                        </li>
                        <li>
                            パラメータ \(\boldsymbol{w}\) を \(E\) 回更新する。
                            <div class="math">
                                \[
                                \boldsymbol{w}\gets\boldsymbol{w}-\eta\cdot\frac{1}{N}\sum_{i=1}^N \left\{ \sigma(\boldsymbol{w}^\top\boldsymbol{x}_i) - y_i \right\}\boldsymbol{x}_i
                                \]
                            </div>
                            ただし、\(\sigma(t)=\dfrac{1}{1+e^{-t}}\) である。
                        </li>
                        <li>
                            学習された分類器 \(f(\boldsymbol{x};\boldsymbol{w})\) にデータを代入する。
                            <div class="math">
                                \[
                                f(\boldsymbol{x}_i;\boldsymbol{w})=\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i) \quad (i=1,\cdots,N)
                                \]
                            </div>
                        </li>
                        <li>
                            分類結果を出力する。
                            <div class="math">
                                \[
                                \hat{y}_i=
                                \begin{cases}
                                0 & (f(\boldsymbol{x}_i;\boldsymbol{w}) \lt 0.5) \\
                                1 & (f(\boldsymbol{x}_i;\boldsymbol{w}) \ge 0.5)
                                \end{cases}
                                \]
                            </div>
                        </li>
                    </ol>
                </figure>
            </section>
            <section id="2">
                <h2>ロジスティック回帰の理論</h2>
                <p class="indent">
                    次のようなデータセットが与えられたとします。
                </p>
                <div class="math">
                    \[
                    \{(\boldsymbol{x}_i,y_i) \mid \boldsymbol{x}_i\in\mathbb{R}^d,~y_i\in\{0,1\}\}_{i=1}^N
                    \]
                </div>
                <p>
                    説明変数 \(\boldsymbol{x}_i\) から、目的変数 \(y_i\) がクラス \(0,1\) のどちらに属するかを予測する、分類モデルを考えます。
                    分類方法は、クラス \(1\) に属する確率 \(p\) とするとき
                </p>
                <div class="math">
                    \[
                    \hat{y}_i=
                    \begin{cases}
                    0 & (p \lt 0.5) \\
                    1 & (p \ge 0.5)
                    \end{cases}
                    \]
                </div>
                <p class="indent">
                    説明変数 \(\boldsymbol{x}_i\in\mathbb{R}^d\) とパラメータ（重み） \(\boldsymbol{w}\in\mathbb{R}^d\) を
                </p>
                <div class="math">
                    \[
                    \boldsymbol{x}_i=
                    \begin{bmatrix}
                    x_{i1} \\ x_{i2} \\ \vdots \\ x_{id}
                    \end{bmatrix}
                    ,\quad
                    \boldsymbol{w}=
                    \begin{bmatrix}
                    w_1 \\ w_2 \\ \vdots \\ w_d
                    \end{bmatrix}
                    \]
                </div>
                <div class="math">
                    \[
                    \boldsymbol{w}^\top\boldsymbol{x}_i=w_1x_{i1}+w_2x_{i2}+\cdots+w_dx_{id}
                    \]
                </div>
                <p>
                    を考えます。
                    しかし、このままだと値は実数全体 \((-\infty,\infty)\) をとるので、この値域が \([0,1]\) になるように変換する必要があります。
                </p>
                <p class="indent">
                    そこで、次の関数を考えます。
                </p>
                <div class="math">
                    \[
                    \sigma(t)=\frac{1}{1+e^{-t}}
                    \]
                </div>
                <p>
                    この関数は<strong>シグモイド関数</strong>と呼ばれ、出力は必ず \(0\) から \(1\) の範囲に収まります。
                </p>
                <p class="indent">
                    シグモイド関数に \(\boldsymbol{w}^\top\boldsymbol{x}_i\) を代入したものを、クラス \(1\) に属する確率とします。
                    つまり分類器は
                </p>
                <div class="math">
                    \[
                    f(\boldsymbol{x};\boldsymbol{w})=\sigma(\boldsymbol{w}^\top\boldsymbol{x})
                    \]
                </div>
                <p class="indent">
                    確率値による分類なので、交差エントロピー損失
                </p>
                <div class="math">
                    \[
                    \ell(y,\hat{y}) = -y\log\hat{y}-(1-y)\log(1-\hat{y})
                    \]
                </div>
                <p>
                    を用います。
                </p>
                <div class="math">
                    \[
                    \ell(y,f(\boldsymbol{x};\boldsymbol{w})) = -y\log\sigma(\boldsymbol{w}^\top\boldsymbol{x})-(1-y)\log(1-\sigma(\boldsymbol{w}^\top\boldsymbol{x}))
                    \]
                </div>
                <p>
                    よって、損失関数は
                </p>
                <div class="math">
                    \[
                    L(\boldsymbol{w}) = -\frac{1}{N}\sum_{i=1}^N \left\{ y_i\log\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i) + (1-y_i)\log(1-\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i)) \right\}
                    \]
                </div>
                <p>
                    となり、最適化問題
                </p>
                <div class="math">
                    \[
                    \min_{\boldsymbol{w}}L(\boldsymbol{w})
                    \]
                </div>
                <p>
                    を考えます。
                </p>
                <div class="math">
                    \[
                    \begin{align}
                    \frac{\partial L(\boldsymbol{w})}{\partial\boldsymbol{w}}
                    &=-\frac{1}{N}\frac{\partial}{\partial\boldsymbol{w}}\sum_{i=1}^N \left[ y_i\log \{\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i)\}+(1-y_i)\log\{1-\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i)\} \right]\\
                    &=-\frac{1}{N}\sum_{i=1}^N \frac{\partial}{\partial\boldsymbol{w}} \left[ y_i\log \{\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i)\}+(1-y_i)\log\{1-\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i)\} \right]\\
                    &=-\frac{1}{N}\sum_{i=1}^N \left\{ y_i \frac{\sigma_{\boldsymbol{w}}(\boldsymbol{w}^\top\boldsymbol{x}_i)}{\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i)}+(1-y_i)\frac{-\sigma_{\boldsymbol{w}}(\boldsymbol{w}^\top\boldsymbol{x}_i)}{1-\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i)} \right\}\\
                    &=-\frac{1}{N}\sum_{i=1}^N \left\{ y_i \frac{\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i)\{1-\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i)\}\boldsymbol{x}_i}{\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i)}-(1-y_i)\frac{\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i)\{1-\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i)\}\boldsymbol{x}_i}{1-\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i)} \right\}\\
                    &=-\frac{1}{N}\sum_{i=1}^N \left\{ y_i \{1-\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i)\}\boldsymbol{x}_i-(1-y_i)\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i)\boldsymbol{x}_i \right\}\\
                    &=-\frac{1}{N}\sum_{i=1}^N \left\{ y_i-y_i\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i)-\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i)+y_i\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i) \right\}\boldsymbol{x}_i\\
                    &=-\frac{1}{N}\sum_{i=1}^N \left\{ y_i-\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i) \right\}\boldsymbol{x}_i\\
                    &=\frac{1}{N}\sum_{i=1}^N \left\{ \sigma(\boldsymbol{w}^\top\boldsymbol{x}_i) - y_i \right\}\boldsymbol{x}_i
                    \end{align}
                    \]
                </div>
                <p>
                    よって、パラメータの更新式は次のようになります。
                </p>
                <div class="math">
                    \[
                    \boldsymbol{w}\gets\boldsymbol{w}-\eta\cdot\frac{1}{N}\sum_{i=1}^N \left\{ \sigma(\boldsymbol{w}^\top\boldsymbol{x}_i) - y_i \right\}\boldsymbol{x}_i
                    \]
                </div>
                <p class="indent">
                    また、データ行列 \(X\) と出力ベクトル \(\boldsymbol{y}\) を
                </p>
                <div class="math">
                    \[
                    X=
                    \begin{bmatrix}
                    \boldsymbol{x}_1^\top \\
                    \boldsymbol{x}_2^\top \\
                    \vdots \\
                    \boldsymbol{x}_N^\top
                    \end{bmatrix}
                    \in\mathbb{R}^{N\times d}
                    ,\quad
                    \boldsymbol{y}=
                    \begin{bmatrix}
                    y_1 \\ y_2 \\ \vdots \\ y_N
                    \end{bmatrix}
                    \in\mathbb{R}^{N}
                    \]
                </div>
                <p>
                    とすると、次のようにも書けます。
                </p>
                <div class="math">
                    \[
                    \boldsymbol{w}\gets\boldsymbol{w}-\eta\cdot\frac{1}{N}X^\top(\sigma(X\boldsymbol{w}) - \boldsymbol{y})
                    \]
                </div>
            </section>
            <section id="3">
                <h2>損失関数</h2>
                <div class="math">
                    \[
                    \{y_i\,|\,\boldsymbol{x}_i,\boldsymbol{w}\}\sim \mathrm{Bernoulli}(\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i))
                    \]
                </div>
                <p>
                    なので、尤度は
                </p>
                <div class="math">
                    \[
                    \begin{align}
                    P(\mathcal{Y}\,|\,\mathcal{X},\boldsymbol{w})
                    &=\prod_{i=1}^N P(y_i\,|\,\boldsymbol{x}_i,\boldsymbol{w})\\
                    &=\prod_{i=1}^N \{\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i)\}^{y_i}\{1-\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i)\}^{1-y_i}
                    \end{align}
                    \]
                </div>
                <p>
                    負の対数尤度を考えると
                </p>
                <div class="math">
                    \[
                    \begin{align}
                    &-\log P(\mathcal{Y}\,|\,\mathcal{X},\boldsymbol{w})\\
                    &=-\sum_{i=1}^N \log \left[ \{\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i)\}^{y_i}\{1-\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i)\}^{1-y_i} \right]\\
                    &=-\sum_{i=1}^N \left[ y_i\log \{\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i)\}+(1-y_i)\log\{1-\sigma(\boldsymbol{w}^\top\boldsymbol{x}_i)\} \right]
                    \end{align}
                    \]
                </div>
            </section>
        </main>
        <footer id="footer"></footer>
        <script src="../js/header.js"></script>
        <script src="../js/sidebar.js"></script>
        <script src="../js/footer.js"></script>
        <script src="../js/script.js"></script>
    </body>
</html>